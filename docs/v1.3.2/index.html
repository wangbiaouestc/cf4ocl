<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>cf4ocl (C Framework for OpenCL): Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">cf4ocl (C Framework for OpenCL)
   </div>
   <div id="projectbrief">Utilities and libraries for developing and benchmarking OpenCL projects in the C programming language.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">cf4ocl (C Framework for OpenCL) Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The C Framework for OpenCL, <em>cf4ocl</em>, is a cross-platform pure C99 set of libraries and utilities with the following goals:</p>
<ol type="1">
<li>Promote the rapid development of OpenCL C programs.</li>
<li>Assist in the benchmarking of OpenCL events, such as kernel execution and data transfers.</li>
<li>Simplify the analysis of the OpenCL environment and of kernel requirements.</li>
</ol>
<p><em>cf4ocl</em> is divided into four parts: i) library ii) command-line utilities iii) unit tests and, iv) examples. Part i), the library, offers functions which aim to achieve goals 1 and 2. The command-line utilities, part ii), are focused on goal 3. The unit tests, part iii), aim to verify that the library functions are working properly. Finally, the examples show how to integrate the library functions in fully working OpenCL programs.</p>
<p><em>cf4ocl</em> works in Linux, Windows and Mac OSX, although, being pure C99, it should compile on other platforms, as long as the dependencies, <a href="https://developer.gnome.org/glib/" title="GLib">GLib</a> and <a href="http://www.khronos.org/opencl/" title="OpenCL">OpenCL</a>, are met. The reference compiler is GCC with <code>-Wall</code> and <code>-Wextra</code> flags activated. The code is verified with <a href="http://cppcheck.sourceforge.net/" title="cppcheck">cppcheck</a> and is fully commented. API documentation can be generated with <a href="http://www.doxygen.org/‎" title="Doxygen">Doxygen</a> via <code>make</code>.</p>
<p>Library code is licensed under <a href="http://www.gnu.org/licenses/lgpl.html)" title="LGPLv3">LGPLv3</a>, while the remaining code is licensed under <a href="http://www.gnu.org/licenses/gpl.html" title="GPLv3">GPLv3</a>.</p>
<h1>Table of contents </h1>
<ol type="1">
<li><a href="#introduction">Introduction</a> 1.1. <a href="#library">Library</a> 1.1.1. <a href="#clutils">CL Utils</a> 1.1.2. <a href="#clprofiler">CL Profiler</a> 1.1.3. <a href="#clerrors">CL Errors</a> 1.1.4. <a href="#gerrorframework">GError framework</a> 1.2. <a href="#utilities">Utilities</a> 1.2.1. <a href="#devicequery">Device query</a> 1.2.2. <a href="#kernelinfo">Kernel info</a></li>
<li><a href="#howtouse_cf4ocl_">How to use _cf4ocl_</a> 2.1. <a href="#dependencies">Dependencies</a> 2.1.1. <a href="#opencl">OpenCL</a> 2.1.2. <a href="#glib">GLib</a> 2.2. <a href="#downloadbuildandinstall">Download, build and install</a> 2.3. <a href="#usingthelibraryinanewproject">Using the library in a new project</a> 2.3.1. <a href="#compilingandlinking">Compiling and linking</a> 2.3.1.1. <a href="#cmake">CMake</a> 2.3.1.2. <a href="#gnumake">GNU Make</a> 2.3.1.2.1. <a href="#compiling">Compiling</a> 2.3.1.2.2. <a href="#linking">Linking</a> 2.3.2. <a href="#usingclutils">Using CL Utils</a> 2.3.3. <a href="#usingclprofiler">Using CL Profiler</a> 2.3.4. <a href="#usingclerrors">Using CL Errors</a> 2.3.5. <a href="#usinggerrorframeworkgerrorf">Using GError Framework (GErrorF)</a></li>
<li><a href="#otherusefulcframeworks/utilitiesforopencl">Other useful C frameworks/utilities for OpenCL</a></li>
</ol>
<p><a class="anchor" id="introduction"></a></p>
<h1>1. Introduction </h1>
<p><em>cf4ocl</em> is divided into four parts, with the following structure:</p>
<ol type="1">
<li>Library<ul>
<li>CL Utils</li>
<li>CL Profiler</li>
<li>CL Errors</li>
<li>GError framework</li>
</ul>
</li>
<li>Library tests<ul>
<li>CL Profiler</li>
<li>GError framework</li>
</ul>
</li>
<li>Utilities<ul>
<li>Device query</li>
<li>Kernel info</li>
</ul>
</li>
<li>Examples<ul>
<li>Bank conflicts test</li>
<li>Matrix multiplication</li>
</ul>
</li>
</ol>
<p>The following sections describe each of the parts in additional detail.</p>
<p><a class="anchor" id="library"></a></p>
<h2>1.1. Library </h2>
<p>The library offers functions which promote the rapid development of OpenCL C programs, <em>CL Utils</em>, as well as their detailed benchmarking, <em>CL Profiler</em>. The library also facilitates error management in two ways: i) by converting OpenCL error codes into human readable strings, <em>CL Errors</em> ii) by exposing a generic error handling framework, <em>GError framework</em>, used internally by <em>CL Utils</em> and <em>CL Profiler</em>.</p>
<p><a class="anchor" id="clutils"></a></p>
<h3>1.1.1. CL Utils</h3>
<p>The <em>CL Utils</em> section of the library allows the initialization of OpenCL environment objects, such as platform, device, context, command queues and devices, with a single function, <code>clu_zone_new</code>, thus avoiding the typical boilerplate code required for this setup. Device selection is decoupled from the OpenCL environment setup, being performed with a function passed as a parameter to <code>clu_zone_new</code>. The library supplies functions to accomplish this task automatically or through user interaction, although the client programmer can supply its own function with the required selection criteria. The destruction of the OpenCL environment, i.e. the removal of the respective objects from memory, is also achieved with one function, namely <code>clu_zone_free</code>.</p>
<p>Kernel compilation is simplified by the <code>clu_program_create</code> function, which can be used to build OpenCL device programs by passing an array of filenames containing kernel code.</p>
<p>The data structures in <em>CL Utils</em> are completely transparent to the client programmer, allowing access the underlying OpenCL objects at all times.</p>
<p><a class="anchor" id="clprofiler"></a></p>
<h3>1.1.2. CL Profiler</h3>
<p>The functions in <em>CL Profiler</em> allow the client programmer to obtain detailed profiling information about OpenCL functions for kernel execution and host-device memory transfers, including relative and absolute execution times. Profiling information is obtained using OpenCL events, which can be associated with the relevant OpenCL functions. <em>CL Profiler</em> supports multiple command queues and overlapping events, such as simultaneous kernel executions and data transfers. Profiling information can be exported in a configurable format, and plotted using a script included in <em>cf4ocl</em>.</p>
<p><a class="anchor" id="clerrors"></a></p>
<h3>1.1.3. CL Errors</h3>
<p><em>CL Errors</em> offers a single function which converts a OpenCL error into a human readable string.</p>
<p><a class="anchor" id="gerrorframework"></a></p>
<h3>1.1.4. GError framework</h3>
<p>The <em>GError framework</em> is internally used by <em>CL Utils</em> and <em>CL Profiler</em> for error handling purposes. However, the framework is not in any way tied to OpenCL, so it can be used generically in any C program. It is composed of three macros and it is based on the <code>GError</code> object from GLib.</p>
<p><a class="anchor" id="utilities"></a></p>
<h2>1.2. Utilities </h2>
<p><a class="anchor" id="devicequery"></a></p>
<h3>1.2.1. Device query</h3>
<p>Simple implementation of a program for querying available OpenCL platforms and devices with clean and useful output.</p>
<p><a class="anchor" id="kernelinfo"></a></p>
<h3>1.2.2. Kernel info</h3>
<p>The <code>kernel_info</code> program performs static analysis of OpenCL kernels.</p>
<p><a class="anchor" id="howtouse_cf4ocl_"></a></p>
<h1>2. How to use <em>cf4ocl</em> </h1>
<p><a class="anchor" id="dependencies"></a></p>
<h2>2.1. Dependencies </h2>
<p>In order to compile <em>cf4ocl</em> and use it in projects, two dependencies are required: 1) <a href="http://www.khronos.org/opencl/" title="OpenCL">OpenCL</a> and, 2) <a href="https://developer.gnome.org/glib/" title="GLib">GLib</a> (v2.32 or newer).</p>
<p><a class="anchor" id="opencl"></a></p>
<h3>2.1.1. OpenCL</h3>
<p>The OpenCL headers (for compiling) and shared library (for linking) can be installed from the packages offered by different OpenCL vendors such as <a href="http://developer.amd.com/tools-and-sdks/heterogeneous-computing/amd-accelerated-parallel-processing-app-sdk/" title="AMD">AMD</a>, <a href="http://software.intel.com/en-us/vcsource/tools/opencl-sdk" title="Intel">Intel</a> or <a href="https://developer.nvidia.com/category/zone/cuda-zone" title="Nvidia">Nvidia</a>.</p>
<p>Alternatively, it is possible to install an OpenCL development environment in a some recent Linux distributions. For example, in Debian 7 and Ubuntu 13.04: </p><pre class="fragment">$ sudo apt-get install ocl-icd-opencl-dev
</pre><p>This will install the headers and shared library system-wide, avoiding the need to specify their location to GCC. However, to actually run an OpenCL program it is necessary to have a vendor implementation installed.</p>
<p><a class="anchor" id="glib"></a></p>
<h3>2.1.2. GLib</h3>
<p>The simplest way to install <a href="https://developer.gnome.org/glib/" title="GLib">GLib</a> on Linux is through the package manager of the respective distribution. For Debian and Ubuntu: </p><pre class="fragment">$ sudo apt-get install libglib2.0-dev
</pre><p>It is also advisable to install the <code>libglib2.0-0-dbg</code> or equivalent package to allow debugging at the GLib level.</p>
<p>This <a href="http://www.gtk.org/download/win32_tutorial.php">tutorial</a> explains how to install GLib in Windows.</p>
<p><a class="anchor" id="downloadbuildandinstall"></a></p>
<h2>2.2. Download, build and install </h2>
<p><em>cf4ocl</em> uses the <a href="http://www.cmake.org/">CMake</a> build system. Assuming a working development environment with GCC and CMake installed, and the dependencies (OpenCL and GLib) properly setup, either clone or download and extract <em>cf4ocl</em> into a location of your preference. The <em>cf4ocl</em> directory tree will have the following structure: </p><pre class="fragment">cf4ocl/
|
+-- cmake
|   |
|   +-- Modules
|
+-- images
|
+-- scripts
|
+-- src
    |
    +-- examples
    |
    +-- lib
    |
    +-- tests
    |
    +-- utils
</pre><p>Within the <em>cf4ocl</em> directory, create a folder named <code>build</code>. This is where the project will be built, such that the contents of the <em>cf4ocl</em> folder (source code, scripts, etc.), are kept separate from the build files.</p>
<p>Next, <code>cd</code> into the <code>build</code> folder and run the <code>cmake ..</code> command. If OpenCL and GLib are successfully found by CMake, the Makefiles required for building and installing <em>cf4ocl</em> are created. If an error occurrs, it might be necessary to manually provide the location of these dependencies. In order to do so, run the <code>ccmake ..</code> command, which offers a configuration interface for this purpose. Alternatively, run the CMake GUI, chose the <em>cf4ocl</em> directory as the source code location and the <code>build</code> directory as the place where to build the binaries. Specify the library and include locations for OpenCL and GLib, click "Configure", then "Generate". The makefiles should now have been generated.</p>
<p>In order to build the project, run <code>make</code> in the <code>build</code> folder. Project installation can be accomplished with <code>make install</code>. By default, <em>cf4ocl</em> is installed system wide, which requires the later command to be executed as root or administrator (e.g. using <code>sudo</code> in Linux, or an elevated priviledge command prompt on Windows). The install location can be changed with the <code>ccmake</code> command, or with the CMake GUI. The tests can be compiled separately with <code>make tests</code>.</p>
<p>After installation, the <em>cf4ocl</em> shared library should be registered with <code>ldconfig</code> (Linux) or <code>regsvr32</code> (Windows), such that client applications can find it at runtime.</p>
<p>The API documentation can be generated with <code>make</code> if <a href="http://www.doxygen.org/‎" title="Doxygen">Doxygen</a> (version 1.8.3 or newer) is installed. In the <em>cf4ocl</em> directory run: </p><pre class="fragment">$ make doc
</pre><p>The documentation will be generated in the <code>./doc</code> folder. The direct use of the <code>doxygen</code> command should be avoided because <a href="http://www.stack.nl/~dimitri/doxygen/manual/markdown.html" title="Doxygen Markdown">Doxygen's markdown</a> is not 100% compatible with the <a href="https://help.github.com/articles/github-flavored-markdown" title="Github Flavored Markdown">GitHub Flavored Markdown</a> used in this document. When building the documentation with <code>make</code>, the required conversion is performed first.</p>
<p><a class="anchor" id="usingthelibraryinanewproject"></a></p>
<h2>2.3. Using the library in a new project </h2>
<p>Any of the three elements of the library can be used in a workflow without the need to use the others. However, both CL Utils and CL Profiler internally use the GError framework. The <em>cf4ocl</em> header includes all the definitions for the three elements of the library. This header can be included as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cf4ocl_8h.html">cf4ocl.h</a>&gt;</span></div>
</div><!-- fragment --><p><a class="anchor" id="compilingandlinking"></a></p>
<h3>2.3.1. Compiling and linking</h3>
<p><a class="anchor" id="cmake"></a></p>
<h4>2.3.1.1. CMake</h4>
<p>If client code uses CMake as its build system, then it is very simple to integrate <em>cf4ocl</em>. Add the following lines to your CMakeLists.txt file:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Find required libraries</span></div>
<div class="line">find_package(PkgConfig REQUIRED)</div>
<div class="line">find_package(Cf4ocl REQUIRED)</div>
<div class="line">pkg_check_modules(GLIB REQUIRED glib-2.0&gt;=2.32.1)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Library include directories</span></div>
<div class="line"><span class="preprocessor">include_directories(${GLIB_INCLUDE_DIRS} ${CF4OCL_INCLUDE_DIRS})</span></div>
</div><!-- fragment --><p><em>cf4ocl</em> can be found by CMake through a module included in the project for this purpose. Take a look at the <a href="https://github.com/FakenMC/cl-ops/">CL-Ops</a> project for an example on how to do so.</p>
<p><a class="anchor" id="gnumake"></a></p>
<h4>2.3.1.2. GNU Make</h4>
<p><a class="anchor" id="compiling"></a></p>
<h5>2.3.1.2.1. Compiling</h5>
<p>Depending on how <em>cf4ocl</em> was installed, it may be necessary to specify the location of the <em>cf4ocl</em> header with the <code>-I</code> flag. The same is true for the GLib and OpenCL headers, which are included by the <em>cf4ocl</em> header. For GLib, instead of directly specifying the header location, it is also possible to use PkgConfig instead: </p><pre class="fragment">`pkg-config --cflags glib-2.0`
</pre><p><a class="anchor" id="linking"></a></p>
<h5>2.3.1.2.2. Linking</h5>
<p>It is necessary to specify the use of the <em>cf4ocl</em> with the <code>-l</code> flag, e.g.: </p><pre class="fragment">-lcf4ocl
</pre><p>Again, depending on how <em>cf4ocl</em> was installed, it may be necessary to specify the location of the <em>cf4ocl</em> shared library with the <code>-L</code> flag.</p>
<p><a class="anchor" id="usingclutils"></a></p>
<h3>2.3.2. Using CL Utils</h3>
<p>The functions provided by CL Utils aim to facilitate the rapid development and deployment of C programs which use OpenCL. These functions are focused on two key tasks:</p>
<ol type="1">
<li>Setup and tear down of the OpenCL environment, including device, context and command queues.</li>
<li>Loading, compilation and tear down of OpenCL kernel programs.</li>
</ol>
<p>These two tasks require very verbose code, with significant repetition between projects. CL Utils wraps these tasks into two functions, providing an additional third function for freeing up the allocated resources. The OpenCL objects created by CL Utils are available to the client programmer at all times through the <code>CLUZone</code> object. CL Utils does not wrap any other OpenCL tasks, such as kernel execution or data transfers, which can be performed directly with the respective OpenCL functions.</p>
<p>The first task is performed with the <code>clu_zone_new</code> function, which has the following prototype:</p>
<div class="fragment"><div class="line"><a class="code" href="structclu__zone.html">CLUZone</a>* <a class="code" href="clutils_8c.html#aafef46ba2df88c456ba056b4806ef51e">clu_zone_new</a>(</div>
<div class="line">    <span class="comment">/* Type of device, e.g. CL_DEVICE_TYPE_CPU, CL_DEVICE_TYPE_GPU, etc. */</span></div>
<div class="line">    cl_uint deviceType,</div>
<div class="line">    <span class="comment">/* Number of command queues. */</span></div>
<div class="line">    cl_uint numQueues,</div>
<div class="line">    <span class="comment">/* Command queue properties, e.g. CL_QUEUE_PROFILING_ENABLE, etc. */</span></div>
<div class="line">    <a class="code" href="test__profiler_8h.html#acb66e7b68fd648501579ef19dc41265a">cl_int</a> queueProperties,</div>
<div class="line">    <span class="comment">/* Pointer to a device selector function. */</span></div>
<div class="line">    <a class="code" href="clutils_8h.html#a7103e36d818a1f49008c770d17b1df17">clu_device_selector</a> devSel, </div>
<div class="line">    <span class="comment">/* Extra arguments for device selector function. */</span></div>
<div class="line">    <span class="keywordtype">void</span>* dsExtraArg, </div>
<div class="line">    <span class="comment">/* GLib&#39;s error reporting object (may be ignored). */</span></div>
<div class="line">    GError **err</div>
<div class="line">)</div>
</div><!-- fragment --><p>The returned <code>CLUZone</code> object will contain the context, command queues, device information and an uninitialized kernel program. The program is initialized with the <code>clu_program_create</code> function as part of the second task. This function has the following prototype:</p>
<div class="fragment"><div class="line"><a class="code" href="test__profiler_8h.html#acb66e7b68fd648501579ef19dc41265a">cl_int</a> <a class="code" href="clutils_8c.html#a321d53c508616c0e432488bcdb78b6cf">clu_program_create</a>(</div>
<div class="line">    <span class="comment">/* The CLUZone object return by the clu_zone_new function. */</span></div>
<div class="line">    <a class="code" href="structclu__zone.html">CLUZone</a>* zone, </div>
<div class="line">    <span class="comment">/* List of files containing the source code for the kernels. */</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>** kernelFiles, </div>
<div class="line">    <span class="comment">/* Number of kernel files given in the previous parameter. */</span></div>
<div class="line">    cl_uint numKernelFiles, </div>
<div class="line">    <span class="comment">/* Compiler options. */</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* compilerOpts, </div>
<div class="line">    <span class="comment">/* GLib&#39;s error reporting object (may be ignored). */</span></div>
<div class="line">    GError **err</div>
<div class="line">)</div>
</div><!-- fragment --><p>A typical usage pattern of CL Utils in a C program:</p>
<div class="fragment"><div class="line">include <span class="stringliteral">&quot;clutils.h&quot;</span></div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">int <a class="code" href="bank__conflicts_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) </div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">    <a class="code" href="structclu__zone.html">CLUZone</a>* zone = NULL</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* oclSources[] = {<span class="stringliteral">&quot;src1.cl&quot;</span>, <span class="stringliteral">&quot;src2.cl&quot;</span>, <span class="stringliteral">&quot;moresrc.cl&quot;</span>}</div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Get a complete OpenCL environment using a GPU device, one  */</span></div>
<div class="line">    <span class="comment">/* command queue, no command queue options, if more than one  */</span> </div>
<div class="line">    <span class="comment">/* GPU is available show selection menu to user, and ignore   */</span></div>
<div class="line">    <span class="comment">/* error reporting. */</span></div>
<div class="line">    zone = <a class="code" href="clutils_8c.html#aafef46ba2df88c456ba056b4806ef51e">clu_zone_new</a>(CL_DEVICE_TYPE_GPU, 1, 0, <a class="code" href="clutils_8c.html#af96c5c98deef8a8cdde6f7efbc610767">clu_menu_device_selector</a>, NULL, NULL)</div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create (compile) an OpenCL kernel program using three OpenCL */</span></div>
<div class="line">    <span class="comment">/* source files, no compiler options, and ignoring error        */</span></div>
<div class="line">    <span class="comment">/* reporting.                                                   */</span></div>
<div class="line">    status = <a class="code" href="clutils_8c.html#a321d53c508616c0e432488bcdb78b6cf">clu_program_create</a>(zone, oclSources, 3, NULL, NULL)</div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Perform OpenCL tasks such as data transfer and kernel execution */</span></div>
<div class="line">    <span class="comment">/* using the OpenCL objects (queues, program, context, etc.)       */</span></div>
<div class="line">    <span class="comment">/* available within the CLUZone object.                            */</span></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free the CLUZone object and all of the contained OpenCL objects.*/</span></div>
<div class="line">    <span class="comment">/* This object should only be released after all OpenCL objects    */</span></div>
<div class="line">    <span class="comment">/* not controlled by CL Utils (kernels, events, memory objects)    */</span></div>
<div class="line">    <span class="comment">/* are released.                                                   */</span></div>
<div class="line">    <a class="code" href="clutils_8c.html#afe1988e28cbafa40c52f7e74f4b8034e">clu_zone_free</a>(zone)</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>The fourth parameter of <code>clu_zone_new</code> is a pointer to a device selector function, which has the following definition:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> cl_uint (*<a class="code" href="clutils_8h.html#a7103e36d818a1f49008c770d17b1df17">clu_device_selector</a>)(</div>
<div class="line">    <span class="comment">/* Array of available devices and respective information. */</span></div>
<div class="line">    <a class="code" href="structclu__device__info.html">CLUDeviceInfo</a>* devInfos,</div>
<div class="line">    <span class="comment">/* Number of devices in array. */</span></div>
<div class="line">    cl_uint numDevices, </div>
<div class="line">    <span class="comment">/* Extra arguments to selector function. */</span></div>
<div class="line">    <span class="keywordtype">void</span>* extraArg</div>
<div class="line">)</div>
</div><!-- fragment --><p>CL Utils provides two ready to use device selector functions:</p>
<ul>
<li><code>clu_menu_device_selector</code> - If more than one device exists, presents a selection menu to the user. If extra argument is given it should be the array index of the preferred device.</li>
<li><code>clu_info_device_selector</code> - Selects a device by device name, device vendor and/or platform name, any/all of which are given in the extra argument.</li>
</ul>
<p>For other device selection requirements, the client programmer can develop a specific device selector function.</p>
<p><a class="anchor" id="usingclprofiler"></a></p>
<h3>2.3.3. Using CL Profiler</h3>
<p>The goal of CL Profiler is to provide detailed benchmarking information about OpenCL events such as kernel execution, data transfers, and so on. CL Profiler is prepared to handle overlapping events, which usually take place when the programmer is trying to optimize its application by simultaneously transfer data to and from the OpenCL device and execute kernels, using different command queues.</p>
<p>CL Profiler consists of two files, <code><a class="el" href="clprofiler_8c.html" title="Function implementations of a profiling tool for OpenCL. ">clprofiler.c</a></code> and <code><a class="el" href="clprofiler_8h.html" title="Function headers of a profiling tool for OpenCL. ">clprofiler.h</a></code>. In order to use CL Profiler in a project, it is necessary to include the <code><a class="el" href="clprofiler_8h.html" title="Function headers of a profiling tool for OpenCL. ">clprofiler.h</a></code> header file.</p>
<p>For the purpose of this explanation, we will consider that two command queues are being used:</p>
<div class="fragment"><div class="line"><a class="code" href="test__profiler_8h.html#aff736eb04c08c6d463cceb54ccb9eae0">cl_command_queue</a> queue0 <span class="comment">/* Used for host-device data transfer. */</span></div>
<div class="line"><a class="code" href="test__profiler_8h.html#aff736eb04c08c6d463cceb54ccb9eae0">cl_command_queue</a> queue1 <span class="comment">/* Used for kernel execution. */</span></div>
</div><!-- fragment --><p>Additionally, we will consider the following OpenCL events:</p>
<div class="fragment"><div class="line"><a class="code" href="structcl_event.html">cl_event</a> ev_transf_in  <span class="comment">/* Transfer data from host to device. */</span></div>
<div class="line"><a class="code" href="structcl_event.html">cl_event</a> ev_kernel_A_1 <span class="comment">/* Execute kernel A on device. */</span></div>
<div class="line"><a class="code" href="structcl_event.html">cl_event</a> ev_kernel_B   <span class="comment">/* Execute kernel B on device. */</span></div>
<div class="line"><a class="code" href="structcl_event.html">cl_event</a> ev_kernel_A_2 <span class="comment">/* Execute kernel A on device again. */</span></div>
<div class="line"><a class="code" href="structcl_event.html">cl_event</a> ev_transf_out <span class="comment">/* Transfer data from device to host. */</span></div>
</div><!-- fragment --><p>The <code>ProfCLProfile</code> structure forms the basis of CL Profiler. It can: 1) measure the total elapsed time of the application (or the relevant part of the application) and, 2) keep track of the device time required by the OpenCL events. The following instruction creates a new <code>ProfCLProfile</code> structure:</p>
<div class="fragment"><div class="line"><span class="comment">/* Create a new ProfCLProfile structure. */</span></div>
<div class="line"><a class="code" href="structprofcl__profile.html">ProfCLProfile</a>* profile = <a class="code" href="clprofiler_8c.html#ab1b31625c65ec819cf1e092da13c9cc0">profcl_profile_new</a>()</div>
</div><!-- fragment --><p>In order to start measuring the relevant part of the application, the following instruction should be issued:</p>
<div class="fragment"><div class="line"><span class="comment">/* Start basic timming / profiling. */</span></div>
<div class="line"><a class="code" href="clprofiler_8c.html#abd2e222ebad6d1ce9015c820a5b7016d">profcl_profile_start</a>(profile)</div>
</div><!-- fragment --><p>At this time, the typical OpenCL application workflow, such as transferring data and executing kernels, should take place. The above defined events must be associated with the respective <code>clEnqueue*</code> OpenCL functions in order to be later analyzed. A typical workflow may be finalized with the following instructions:</p>
<div class="fragment"><div class="line"><span class="comment">/* Finish all pending OpenCL operations. */</span></div>
<div class="line">clFinish(queue0)</div>
<div class="line">clFinish(queue1)</div>
</div><!-- fragment --><p>Profiling should be stopped at this point.</p>
<div class="fragment"><div class="line"><a class="code" href="clprofiler_8c.html#a7785d2882c29b90924130e3c69837d7d">profcl_profile_stop</a>(profile) </div>
</div><!-- fragment --><p>Now the events can be added to the profiler structure. The <code>profcl_profile_add</code> function uses the second parameter (a string) as a key to differentiate between events. Thus, if the same key is given for different OpenCL events, CL Profiler will consider it to be the same <em>semantic</em> event. This can be useful for aggregating execution times of events which occur innumerous times in a cyclic fashion (in a <em>for</em> loop, for example).</p>
<div class="fragment"><div class="line"><span class="comment">/* Add events to be profiled/analyzed. */</span></div>
<div class="line"><a class="code" href="clprofiler_8c.html#ae56bd39303113ae30aa5071fa1c2a6c2">profcl_profile_add</a>(profile, <span class="stringliteral">&quot;Transfer data to device&quot;</span>, ev_transf_in, NULL)</div>
<div class="line"><a class="code" href="clprofiler_8c.html#ae56bd39303113ae30aa5071fa1c2a6c2">profcl_profile_add</a>(profile, &quot;Kernel A&quot;, ev_kernel_A_1, NULL)</div>
<div class="line"><a class="code" href="clprofiler_8c.html#ae56bd39303113ae30aa5071fa1c2a6c2">profcl_profile_add</a>(profile, &quot;Kernel B&quot;, ev_kernel_B, NULL)</div>
<div class="line"><a class="code" href="clprofiler_8c.html#ae56bd39303113ae30aa5071fa1c2a6c2">profcl_profile_add</a>(profile, &quot;Kernel A&quot;, ev_kernel_A_2, NULL)</div>
<div class="line"><a class="code" href="clprofiler_8c.html#ae56bd39303113ae30aa5071fa1c2a6c2">profcl_profile_add</a>(profile, &quot;Transfer data from device&quot;, ev_transf_out, NULL)</div>
</div><!-- fragment --><p>The above code will consider OpenCL events <code>ev_kernel_A_1</code> and <code>ev_kernel_A_2</code> to be the same semantic event because the same key, string <em>Kernel A</em>, is used. Thus, the total execution time for the semantic event <em>Kernel A</em> will be the sum of respective two OpenCL events. CL Profiler can even determine overlaps of a semantic event with itself (i.e., two overlapping OpenCL events which are added for analysis with the same key).</p>
<p>After all the events are added, it is necessary to instruct CL Profiler to perform the required calculations in order to determine the absolute and relative times of all events, and how these correlate with the total elapsed time of the relevant part of the application.</p>
<div class="fragment"><div class="line"><a class="code" href="clprofiler_8c.html#a19fc9b6a7600e585a54943d187697c1c">profcl_profile_aggregate</a>(profile, NULL)</div>
</div><!-- fragment --><p>Finally, the complete benchmarking info can be printed:</p>
<div class="fragment"><div class="line"><a class="code" href="clprofiler_8c.html#ad0626ca896792759a54295bed08fa87d">profcl_print_info</a>(profile, <a class="code" href="clprofiler_8h.html#a90f18e84e6df75461fa0bbfca8271ac6a73e835e914af1e12944ef79a4c185bdf">PROFCL_AGGEVDATA_SORT_TIME</a>, NULL)</div>
</div><!-- fragment --><p>Two detailed tables will be shown on screen: one for individual events (sorted by name or execution time), and another showing event overlaps, if any occurred.</p>
<p>A list of all events can be exported to a file or stream using the <code>profcl_export_info*</code> functions.</p>
<div class="fragment"><div class="line"><a class="code" href="clprofiler_8c.html#a86997b1b0294b548e91b0c36b0e337dd">profcl_export_info_file</a>(profile, <span class="stringliteral">&quot;profileinfo.txt&quot;</span>, NULL)</div>
</div><!-- fragment --><p> Export options, such as field delimiters, field separators, and so on, can be set using the <code><a class="el" href="clprofiler_8c.html#a0191cc11f25092c5e92aea6b3a9d0330" title="Set export options using a ProfCLExportOptions struct. ">profcl_export_opts_set()</a></code> function.</p>
<p>A Gantt chart type graph can be produced from the exported file (using the default options) via a Python script included with <em>cf4ocl</em>:</p>
<p><code>$ python <a class="el" href="plot__events_8py.html">plot_events.py</a> profileinfo.txt</code></p>
<div class="image">
<img src="images/gantt.png"  alt="Events plot for file exported by test_profiler"/>
</div>
<p>A similar plot can also be produced with <a href="http://www.gnuplot.info/">gnuplot</a> using the <a href="http://se.wtb.tue.nl/sewiki/wonham/gantt.py">gantt.py</a> script.</p>
<p>The OpenCL events can be freed after they have been added to the profiler structure and before the program terminates.</p>
<div class="fragment"><div class="line">clReleaseEvent(ev_transf_in)</div>
<div class="line">clReleaseEvent(ev_kernel_A_1)</div>
<div class="line">clReleaseEvent(ev_kernel_B)</div>
<div class="line">clReleaseEvent(ev_kernel_A_2)</div>
<div class="line">clReleaseEvent(ev_transf_out)</div>
</div><!-- fragment --><p>The last parameter of some of the <code>profcl_*</code> functions is used for error handling and to obtain detailed error messages if an error occurs. By passing <code>NULL</code>, the programmer choses to ignore that feature. Such approach is not critical because all of the error-prone <code>profcl_*</code> functions also return their execution status code. No error handling is performed in this explanation, though.</p>
<p>For map events, CL Profiler provides the <code><a class="el" href="clprofiler_8c.html#a6e60e95aa1526a42bc97994594fa03fe" title="Add OpenCL events to events profile, more specifically adds the start of ev1 and end of ev2 to the pr...">profcl_profile_add_composite()</a></code> function, which accepts two OpenCL events, one relative to the <em>map</em> operation, and the other to the <em>unmap</em> operation. The function uses the start instant of the <em>map</em> event, and the <em>end</em> instant of the <em>unmap</em> event, in order to build a composite semantic event.</p>
<p><a class="anchor" id="usingclerrors"></a></p>
<h3>2.3.4. Using CL Errors</h3>
<p>OpenCL functions usually return an error or status code, so that the client programmer can check if the function call was successful, and if not, what kind of problem occurred. The programmer can either check for all possible errors for a given function call using the OpenCL error constants (which map the error codes), or can just return or print the error code, and then look at the <a href="http://www.khronos.org/registry/cl/api/1.2/cl.h">cl.h</a> header to determine what error occurred. <em>CL Errors</em> allows for a third option: convert the error code into a human readable string. The usage is very simple, consisting of a single call to the <code><a class="el" href="clerrors_8c.html#aa4b9b02b920eb270989434ab3b4d468d" title="Convert OpenCL error code to a readable string. ">clerror_get()</a></code> function, passing the error code as an argument:</p>
<div class="fragment"><div class="line"><a class="code" href="test__profiler_8h.html#acb66e7b68fd648501579ef19dc41265a">cl_int</a> status</div>
<div class="line">...</div>
<div class="line">status = clFinish(some_command_queue)</div>
<div class="line">if (status != <a class="code" href="test__profiler_8h.html#a945238394cd7f518e7196ec80ea74594">CL_SUCCESS</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;An error occurred: %s\n&quot;</span>, <a class="code" href="clerrors_8c.html#aa4b9b02b920eb270989434ab3b4d468d">clerror_get</a>(status))</div>
<div class="line">        ...</div>
<div class="line">}</div>
<div class="line">...</div>
</div><!-- fragment --><p> <a class="anchor" id="usinggerrorframeworkgerrorf"></a></p>
<h3>2.3.5. Using GError Framework (GErrorF)</h3>
<p>The main purpose of GErrorF is to provide error handling constructs to CL Utils and CL Profiler. No knowledge of GErrorF is required to use CL Utils and/or CL Profiler. However, because it is sufficiently generic to be used in any C application, a specific description is warranted.</p>
<p>GErrorF uses GLib's <code>GError</code> object for function error reporting. This explanation assumes some familiarity with <a href="https://developer.gnome.org/glib/2.32/glib-Error-Reporting.html" title="GLib Error Reporting">GLib's error reporting</a>.</p>
<p>GErrorF is defined by three macros in <code><a class="el" href="gerrorf_8h.html" title="Error handling framework based on GLib&#39;s GError object. ">gerrorf.h</a></code>:</p>
<ul>
<li><code>gef_if_error_create_goto</code> - Catches errors from non-GError aware functions.</li>
<li><code>gef_if_error_goto</code> - Catches errors from GError aware functions.</li>
<li><code>gef_if_error_propagate_goto</code> - Same as previous macro, but propagates error in a source GError object to a new destination GError object. Useful for wrapping errors thrown by library / third-party GError aware functions.</li>
</ul>
<p>GErrorF establishes an error handling methodology for C programs not entirely dissimilar to the pattern used in Linux kernel development. Any function producing recoverable runtime errors, from <code>main</code> to functions located deeper in the call stack, can benefit from this approach. The general usage of GErrorF is as follows:</p>
<div class="fragment"><div class="line">include <span class="stringliteral">&quot;gerrorf.h&quot;</span></div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line">int <a class="code" href="bank__conflicts_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) </div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Must initialize every allocable pointers and objects */</span></div>
<div class="line">    <span class="comment">/* to NULL.                                             */</span></div>
<div class="line">    <span class="keywordtype">int</span> some_vector* = NULL</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* GError object. */</span></div>
<div class="line">    GError *err = NULL</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Function return status. */</span></div>
<div class="line">    <span class="keywordtype">int</span> status = SUCCESS_CODE</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Call a GError aware function (defined bellow). */</span></div>
<div class="line">    some_function(params, &amp;err)</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Catch possible error in GError-aware function. In this */</span></div>
<div class="line">    <span class="comment">/* case the GError object is initialized by the called    */</span></div>
<div class="line">    <span class="comment">/* function.                                              */</span></div>
<div class="line">    <a class="code" href="gerrorf_8h.html#a89166945e6ef4f6792897f0955c26b0d">gef_if_error_goto</a>(</div>
<div class="line">        err,              <span class="comment">/* GError object. */</span></div>
<div class="line">        SOME_ERROR_CODE,  <span class="comment">/* Error code to set in status. */</span></div>
<div class="line">        status,           <span class="comment">/* Function return status. */</span></div>
<div class="line">        error_handler     <span class="comment">/* Label to goto in case of error. */</span></div>
<div class="line">    )</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* In the previous function it is possible to replace an app */</span></div>
<div class="line">    <span class="comment">/* specific error code with GErrorF special constants        */</span></div>
<div class="line">    <span class="comment">/* GEF_USE_STATUS and GEF_USE_GERROR. The former leaves the  */</span></div>
<div class="line">    <span class="comment">/* status variable untouched (useful for cases where the     */</span></div>
<div class="line">    <span class="comment">/* function itself returns a usable int status), while the   */</span></div>
<div class="line">    <span class="comment">/* later sets status to the error code set in the GError     */</span></div>
<div class="line">    <span class="comment">/* object. */</span></div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Call a non-GError aware function. */</span></div>
<div class="line">    some_vector = (<span class="keywordtype">int</span>*) malloc(sizeof(<span class="keywordtype">int</span>) * SOME_SIZE)</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Catch possible error in non-GError aware function. */</span></div>
<div class="line">    <a class="code" href="gerrorf_8h.html#abdf75fa50067bf84ba1274d7ade17c5a">gef_if_error_create_goto</a>(</div>
<div class="line">        err,                    <span class="comment">/* GError object.                  */</span></div>
<div class="line">        SOME_QUARK_ERROR,       <span class="comment">/* GLib GQuark identifier.         */</span></div>
<div class="line">        some_vector == NULL,    <span class="comment">/* Error condition.                */</span></div>
<div class="line">        SOME_ERROR_CODE,        <span class="comment">/* Error code to set in err.       */</span></div>
<div class="line">        error_handler,          <span class="comment">/* Label to goto in case of error. */</span></div>
<div class="line">        &quot;Unable to alloc. mem.&quot; <span class="comment">/* Error msg to set in err.        */</span></div>
<div class="line">    )</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* If we get here, there was no error, goto cleanup. */</span></div>
<div class="line">    g_assert(err == NULL)  <span class="comment">/* Make sure err is NULL. */</span></div>
<div class="line">    goto cleanup           <span class="comment">/* Goto the cleanup section. */</span></div>
<div class="line"></div>
<div class="line">error_handler:</div>
<div class="line">    <span class="comment">/* If we got here there was an error, verify that it is so. */</span></div>
<div class="line">    g_assert (err != NULL)</div>
<div class="line">    <span class="comment">/* Print error message. */</span></div>
<div class="line">    fprintf(stderr, &quot;Error message: %s\n&quot;, err-&gt;message)</div>
<div class="line">    <span class="comment">/* Make sure function status contains an error code. */</span></div>
<div class="line">    if (status == SUCCESS_CODE) status = err-&gt;code </div>
<div class="line">    <span class="comment">/* Free the GError object. */</span></div>
<div class="line">    g_error_free(err)</div>
<div class="line"></div>
<div class="line">cleanup:        </div>
<div class="line">    <span class="comment">/* Free any allocated memory. */</span></div>
<div class="line">    if (some_vector) free(some_vector)</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Return program status. */</span></div>
<div class="line">    return status</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">/* This function is GError-aware, and will initialize the GError */</span></div>
<div class="line"><span class="comment">/* object if an error occurs. The GError object usually comes    */</span></div>
<div class="line"><span class="comment">/* as the last parameter.                                        */</span></div>
<div class="line"><span class="keywordtype">void</span> some_function(some params, GError** err) </div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    FILE* fp</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* filename = <span class="stringliteral">&quot;somefile.txt&quot;</span></div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Try to open a file. This function is not GError aware. */</span></div>
<div class="line">    fp = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>)</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Catch possible error in non-GError aware function. */</span></div>
<div class="line">    <a class="code" href="gerrorf_8h.html#abdf75fa50067bf84ba1274d7ade17c5a">gef_if_error_create_goto</a>(</div>
<div class="line">        *err,                     <span class="comment">/* GError object.                  */</span></div>
<div class="line">        SOME_QUARK_ERROR,         <span class="comment">/* GLib GQuark identifier.         */</span></div>
<div class="line">        fp == NULL,               <span class="comment">/* Error condition.                */</span></div>
<div class="line">        SOME_ERROR_CODE,          <span class="comment">/* Error code to set in err.       */</span></div>
<div class="line">        error_handler,            <span class="comment">/* Label to goto in case of error. */</span></div>
<div class="line">        &quot;Unable to open file %s&quot;, <span class="comment">/* Error msg to set in err.        */</span></div>
<div class="line">        filename                  <span class="comment">/* Extra args for error msg.       */</span></div>
<div class="line">    )</div>
<div class="line"></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* If we got here, everything is OK.                          */</span></div>
<div class="line">    <span class="comment">/* It&#39;s good practice to check if err is NULL (caller doesn&#39;t */</span></div>
<div class="line">    <span class="comment">/* care about error reporting OR if a non-null err is         */</span></div>
<div class="line">    <span class="comment">/* pointing to NULL (i.e. no error was reported).             */</span></div>
<div class="line">    g_assert (err == NULL || *err == NULL)</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Goto finish label, ignoring the error handling section.    */</span></div>
<div class="line">    goto finish</div>
<div class="line"></div>
<div class="line">error_handler:</div>
<div class="line">    <span class="comment">/* If we got here there was an error, verify that it is so,   */</span></div>
<div class="line">    <span class="comment">/* i.e. either the caller doesn&#39;t care about error reporting, */</span></div>
<div class="line">    <span class="comment">/* in which case err is NULL, OR a non-null err is in fact    */</span></div>
<div class="line">    <span class="comment">/* pointing to an initialized GError object.                  */</span></div>
<div class="line">    g_assert (err == NULL || *err != NULL)</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Run any other error handling code. */</span></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">finish: </div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Close the file, if open. */</span></div>
<div class="line">    if (fp) fclose(fp)</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Perform additional required cleanup (free&#39;s and so on). */</span></div>
<div class="line">    ...</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Bye. */</span></div>
<div class="line">    return</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>As can be observed, GErrorF enforces a strict programming pattern, which requires that complying functions follow a set of rules:</p>
<ul>
<li>Define all pointers and objects in the beginning of the function and initialize them to NULL.</li>
<li>Define a pointer to a GError object and set it to NULL.</li>
<li>Always test for errors after calls to error throwing functions with <code>gef_if_error_create_goto</code> (non-GError aware functions) or <code>gef_if_error_goto</code> (GError aware functions). If an error occurs program execution will jump to the error handling block.</li>
<li>Use the following pattern at the end of the function:<ul>
<li>goto cleanup</li>
<li>error handling block</li>
<li>cleanup: perform clean up</li>
<li>return (possibly with a status code)</li>
</ul>
</li>
</ul>
<p>This pattern avoids many bugs and makes error catching and handling possible in C. However it is not to everyone's taste, and is thus a completely optional aspect of <em>cf4ocl</em>.</p>
<p><a class="anchor" id="otherusefulcframeworks/utilitiesforopencl"></a></p>
<h1>3. Other useful C frameworks/utilities for OpenCL </h1>
<p>If <em>cf4ocl</em> does not meet your requirements, take a look at the following projects:</p>
<ul>
<li><a href="http://code.google.com/p/simple-opencl/" title="Simple OpenCL">Simple OpenCL</a></li>
<li><a href="https://github.com/Oblomov/CLU" title="The OpenCL utility library">The OpenCL utility library</a></li>
<li><a href="https://github.com/Computing-Language-Utility/CLU" title="Computing Language Utility">Computing Language Utility</a></li>
<li><a href="http://tuxfan.github.io/ocl-mla/" title="OCL-MLA">OCL-MLA</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun May 4 2014 16:52:03 for cf4ocl (C Framework for OpenCL) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
